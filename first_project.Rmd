---
title: "Project report"
author: "Max Narvaez & Ryan Harvey"
date: "9/24/2020"
output:
  pdf_document:
    fig_height: 3
    fig_width: 6.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

rec <- read_csv("time_series_90s_july13.csv") %>%
    select(-`11`:-`34`)
generation.rec.data <- read_csv("lollipop_chart_data_july_13.csv")

x <- nrow(rec)
while (x > 0) {
  y <- 25
  while (y > 1) {
    if (rec[x, y] == 0) {
      rec[x, y] <- NA
      y <- y - 1
    } else {
      break
    }
  }
  x <- x - 1
}
rec
```

```{r flip_sign, include=FALSE}
flip_sign <- function(l) {
     l <- as.numeric(l)*(-1)
     parse(text=l)
}
```

## Instructions

The following document is a template of the report that will be due on Oct 1st at 9am, please change the information in lines 1-4 to have:

* Your project title
* The members of your group

The report *should* be uploaded as a PDF or an HTML document through Moodle. If you submit your project as an .Rmd you will be deducted *20 points* from your project grade.

Please delete the section *Instructions* from your final project

## Article review

This article examines the recognition of hit 90's songs today in order to see how 90's music will be characterized by future generations. The article gathered data through a music quiz where participants were asked if they recognized certain Top 100 Billboard songs from the 90's. Different charts were produced to determine how songs stand the test of time and which songs are most recognized today.

## Description of your dataset

Using a markdown table describe the variables from your dataset that you used for your analysis and whether they were in the original table or were obtained by transforming the original dataset. For variables that were not in the original dataset, briefly describe how you obtain them.

Variable Name        Description
------------------   -------------------------------------------------------------------------------
artist_song          Artist name and song title
generation           Number of years until birth of subject when the song was released
recognition          Proportion of subjects that recognized the song
latest.recognition   Latest recognition data point 
                     (songs were debuted in different years, this is the last data point for a song)
--------------       -------------------------------------------------------------------------------

All of these were from the original datasets. The two datasets "time_series_90s_july13" and "time_series_90s_d3_13_15_averaged_july_22" present the data in different forms. 

## Main conclusions 

Use well-written paragraphs and professional-looking tables and/or graphs to reproduce the main results of your article of interest.

* *90's Music Cannon*:

    * The percent of songs from the 90's recognized currently decays with time.

```{r}
rec %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    geom_smooth(aes(as.numeric(generation), recognition), color = "black") +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "none") +
    labs(x = "Age in year that song was released",
         y = "% of people who know song")

rec %>%
    filter(`-13` >= .9) %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    geom_smooth(aes(as.numeric(generation), recognition), color = "black") +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "none") +
    labs(x = "Age in year that song was released",
         y = "% of people who know song")
```

    * A graph of the top-5 /bottom-5 songs as they are currently remembered

```{r last_non_na_value, include = FALSE}
last_non_na_value <- function(r) {
    cols <- length(r)
    col <- cols - 1
    while (is.na(r[col])) {
        col <- col - 1
    }
    r[col]
}
```

```{r}
current.rec <- rec %>%
    rowwise() %>%
    transmute(artist_song = artist_song,
              latest.recognition = last_non_na_value(c(`-13`, `-12`, `-11`, `-10`, `-9`, 
                                                       `-8`, `-7`, `-6`, `-5`, `-4`,
                                                       `-3`, `-2`, `-1`, `0`, `1`,
                                                       `2`, `3`, `4`, `5`, `6`,
                                                       `7`, `8`, `9`, `10`))) %>%
    arrange(desc(latest.recognition))

top.bottom.5.songs <- union(head(current.rec, 5), tail(current.rec, 5)) %>%
    pull(artist_song)

rec %>%
    filter(artist_song %in% top.bottom.5.songs) %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "bottom", legend.direction = "vertical") +
    guides(color = guide_legend(ncol=2)) +
    labs(x = "Age in year that song was released",
         y = "% of people who know song",
         color = "Artist/Song")
```

    * A graph of the top-5 songs that were popular in the 90's but are rarely heard after that

```{r}
avg.table <- summarize_at(rec,
                          vars(`-13`:`10`),
                          ~ mean(., na.rm = TRUE))

avgs <- c()
avgs["-13"] = avg.table$`-13`
avgs["-12"] = avg.table$`-12`
avgs["-11"] = avg.table$`-11`
avgs["-10"] = avg.table$`-10`
avgs["-9"] = avg.table$`-9`
avgs["-8"] = avg.table$`-8`
avgs["-7"] = avg.table$`-7`
avgs["-6"] = avg.table$`-6`
avgs["-5"] = avg.table$`-5`
avgs["-4"] = avg.table$`-4`
avgs["-3"] = avg.table$`-3`
avgs["-2"] = avg.table$`-2`
avgs["-1"] = avg.table$`-1`
avgs["0"] = avg.table$`0`
avgs["1"] = avg.table$`1`
avgs["2"] = avg.table$`2`
avgs["3"] = avg.table$`3`
avgs["4"] = avg.table$`4`
avgs["5"] = avg.table$`5`
avgs["6"] = avg.table$`6`
avgs["7"] = avg.table$`7`
avgs["8"] = avg.table$`8`
avgs["9"] = avg.table$`9`
avgs["10"] = avg.table$`10`

low_songs <- rec %>%
    filter(`-13` >= .8) %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    mutate(diff = recognition - avgs[as.character(generation)]) %>%
    group_by(song) %>%
    summarize(diff.from.trend = sum(diff)) %>%
    arrange(desc(diff.from.trend)) %>%
    tail(5) %>%
    pull(song)

rec %>%
    filter(artist_song %in% low_songs) %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "bottom", legend.direction = "vertical") +
    guides(color = guide_legend(ncol=2)) +
    labs(x = "Age in year that song was released",
         y = "% of people who know song",
         color = "Artist/Song")
```

    * A graph/table describing the change in recognition across different generations.

## Original question

We want to know how recognized songs are today that were only recognized by less than 50% of people that were 13-15 years old at the time of release. Do some of these songs gain popularity or do most die out?

```{r}
low_rec_at_release <- rec %>%
    filter(`-13` <= .5) %>%
    pivot_longer(`-13`:`10`,
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition))

ggplot(low_rec_at_release) +
geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
geom_smooth(aes(as.numeric(generation), recognition), color = "black") +
scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
theme(legend.position = "none") +
labs(x = "Age in year that song was released",
     y = "% of people who know song")

low_rec_at_release %>%
    mutate(diff = recognition - avgs[as.character(generation)]) %>%
    group_by(song) %>%
    summarize(diff.from.trend = sum(diff)) %>%
    arrange(desc(diff.from.trend)) %>%
    head(5) %>%
    pull(song)
```

Most of these songs appear to die out and not be recognized today. We can tell this by the decreasing slope of the trend line for these songs that we recognized by less than 50% of 13-15 year olds when the song was released. This isn't too surprising of a result. It is interesting to see which of these songs are most recognized today though. The top 2 songs are by Notorious B.I.G. and the next 2 most recognized are by Whitney Houston. It makes sense that these artists are at the top since they are still popular today and have many fans that could recognize some of their least popular songs.
