---
title: "Project report"
author: "Max Narvaez & Ryan Harvey"
date: "9/24/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

recognition.data <- read_csv("time_series_90s_d3_13_15_averaged_july_22.csv")
rec <- read_csv("time_series_90s_july13.csv")
rec[rec == 0] <- NA
```

```{r flip_sign, include=FALSE}
flip_sign <- function(l) {
     l <- as.numeric(l)*(-1)
     parse(text=l)
}
```

## Instructions

The following document is a template of the report that will be due on Oct 1st at 9am, please change the information in lines 1-4 to have:

* Your project title
* The members of your group

The report *should* be uploaded as a PDF or an HTML document through Moodle. If you submit your project as an .Rmd you will be deducted *20 points* from your project grade.

Please delete the section *Instructions* from your final project

## Article review

This article examines the recognition of hit 90's songs today in order to see how 90's music will be characterized by future generations. The article gathered data through a music quiz where participants were asked if they recognized certain Top 100 Billboard songs from the 90's. Different charts were produced to determine how songs stand the test of time and which songs are most recognized today.

## Description of your dataset

Using a markdown table describe the variables from your dataset that you used for your analysis and whether they were in the original table or were obtained by transforming the original dataset. For variables that were not in the original dataset, briefly describe how you obtain them.

Variable Name    Description
--------------   ------------------------------------------------------------------
artist_song      Artist name and song title
generation       Number of years until birth of subject when the song was released
recognition      Proportion of subjects that recognized the song
--------------   ------------------------------------------------------------------

All of these were from the original datasets. The two datasets "time_series_90s_july13" and "time_series_90s_d3_13_15_averaged_july_22" present the data in different forms. 

## Main conclusions 

Use well-written paragraphs and professional-looking tables and/or graphs to reproduce the main results of your article of interest.

* *90's Music Cannon*:

    * The percent of songs from the 90's recognized currently decays with time.
```{r}
rec %>%
    pivot_longer(c(`-13`, `-12`, `-11`, `-10`, `-9`, `-8`, `-7`, `-6`, `-5`, `-4`, `-3`, `-2`, `-1`, `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10`),
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    geom_smooth(aes(as.numeric(generation), recognition), color = "black") +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "none") +
    labs(x = "Age in year that song was released",
         y = "% of people who know song")

rec %>%
    filter(`-13` >= .9) %>%
    pivot_longer(c(`-13`, `-12`, `-11`, `-10`, `-9`, `-8`, `-7`, `-6`, `-5`, `-4`, `-3`, `-2`, `-1`, `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10`),
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    geom_smooth(aes(as.numeric(generation), recognition), color = "black") +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "none") +
    labs(x = "Age in year that song was released",
         y = "% of people who know song")
```
    * A graph of the top-5 /bottom-5 songs as they are currently remembered
```{r last_non_na_value, include = FALSE}
last_non_na_value <- function(r) {
    cols <- lengths(r)
    col <- cols - 1
    while (is.na(r[col])) {
        col <- col - 1
    }
    r[col]
}
```

```{r}
rec %>%
    rowwise() %>%
    mutate(last_value = sum(1))
```
    * A graph of the top-5 songs that were popular in the 90's but are rarely heard after that
```{r}
avg.table <- summarize(rec, 
                       `-13`=mean(`-13`, na.rm = TRUE),
                       `-12`=mean(`-12`, na.rm = TRUE),
                       `-11`=mean(`-11`, na.rm = TRUE),
                       `-10`=mean(`-10`, na.rm = TRUE),
                       `-9`=mean(`-9`, na.rm = TRUE),
                       `-8`=mean(`-8`, na.rm = TRUE),
                       `-7`=mean(`-7`, na.rm = TRUE),
                       `-6`=mean(`-6`, na.rm = TRUE),
                       `-5`=mean(`-5`, na.rm = TRUE),
                       `-4`=mean(`-4`, na.rm = TRUE),
                       `-3`=mean(`-3`, na.rm = TRUE),
                       `-2`=mean(`-2`, na.rm = TRUE),
                       `-1`=mean(`-1`, na.rm = TRUE),
                       `0`=mean(`0`, na.rm = TRUE),
                       `1`=mean(`1`, na.rm = TRUE),
                       `2`=mean(`2`, na.rm = TRUE),
                       `3`=mean(`3`, na.rm = TRUE),
                       `4`=mean(`4`, na.rm = TRUE),
                       `5`=mean(`5`, na.rm = TRUE),
                       `6`=mean(`6`, na.rm = TRUE),
                       `7`=mean(`7`, na.rm = TRUE),
                       `8`=mean(`8`, na.rm = TRUE),
                       `9`=mean(`9`, na.rm = TRUE),
                       `10`=mean(`10`, na.rm = TRUE))

avgs <- c()
avgs["-13"] = mean(rec$`-13`, na.rm = TRUE)
avgs["-12"] = mean(rec$`-12`, na.rm = TRUE)
avgs["-11"] = mean(rec$`-11`, na.rm = TRUE)
avgs["-10"] = mean(rec$`-10`, na.rm = TRUE)
avgs["-9"] = mean(rec$`-9`, na.rm = TRUE)
avgs["-8"] = mean(rec$`-8`, na.rm = TRUE)
avgs["-7"] = mean(rec$`-7`, na.rm = TRUE)
avgs["-6"] = mean(rec$`-6`, na.rm = TRUE)
avgs["-5"] = mean(rec$`-5`, na.rm = TRUE)
avgs["-4"] = mean(rec$`-4`, na.rm = TRUE)
avgs["-3"] = mean(rec$`-3`, na.rm = TRUE)
avgs["-2"] = mean(rec$`-2`, na.rm = TRUE)
avgs["-1"] = mean(rec$`-1`, na.rm = TRUE)
avgs["0"] = mean(rec$`0`, na.rm = TRUE)
avgs["1"] = mean(rec$`1`, na.rm = TRUE)
avgs["2"] = mean(rec$`2`, na.rm = TRUE)
avgs["3"] = mean(rec$`3`, na.rm = TRUE)
avgs["4"] = mean(rec$`4`, na.rm = TRUE)
avgs["5"] = mean(rec$`5`, na.rm = TRUE)
avgs["6"] = mean(rec$`6`, na.rm = TRUE)
avgs["7"] = mean(rec$`7`, na.rm = TRUE)
avgs["8"] = mean(rec$`8`, na.rm = TRUE)
avgs["9"] = mean(rec$`9`, na.rm = TRUE)
avgs["10"] = mean(rec$`10`, na.rm = TRUE)

low_songs <- rec %>%
    filter(`-13` >= .8) %>%
    pivot_longer(c(`-13`, `-12`, `-11`, `-10`, `-9`, `-8`, `-7`, `-6`, `-5`, `-4`, `-3`, `-2`, `-1`, `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10`),
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    mutate(diff = recognition - avgs[as.character(generation)]) %>%
    group_by(song) %>%
    summarize(diff.from.trend = sum(diff)) %>%
    arrange(desc(diff.from.trend)) %>%
    tail(5) %>%
    pull(song)

rec %>%
    filter(artist_song %in% low_songs) %>%
    pivot_longer(c(`-13`, `-12`, `-11`, `-10`, `-9`, `-8`, `-7`, `-6`, `-5`, `-4`, `-3`, `-2`, `-1`, `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10`),
                 names_to = "generation", values_to = "recognition") %>%
    transmute(song = artist_song, generation = generation, recognition = recognition) %>%
    filter(!is.na(recognition)) %>%
    ggplot() +
    geom_line(aes(x = as.numeric(generation), recognition, color = song)) +
    scale_x_continuous(breaks = seq(-13, 10, by = 1), labels = flip_sign) +
    theme(legend.position = "none") +
    labs(x = "Age in year that song was released",
         y = "% of people who know song")
```
    * A graph/table describing the change in recognition across different generations.
```{r}
knitr::kable(arrange(generation.rec.data, desc(generation.rec.data$mean_gen_z_recognition)),
             digits = 2,
             col.names = c("Song", "Millenial", "Gen Z"))
```
    
    
## Original question

Describe the question that you asked from the dataset and a visualization that describes the answer to such question. How do you interpret the dataset and how does it help answer your question.

    
    